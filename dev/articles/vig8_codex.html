<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Voyager">
<title>CODEX exploratory data analysis • Voyager</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="CODEX exploratory data analysis">
<meta property="og:description" content="Voyager">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Voyager</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/install.html">Install</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-technologies">Technologies</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-technologies">
    <a class="dropdown-item" href="../articles/visium_landing.html">Visium</a>
    <a class="dropdown-item" href="../articles/slideseqV2_landing.html">Slide-seq v2</a>
    <a class="dropdown-item" href="../articles/cosmx_landing.html">CosMX</a>
    <a class="dropdown-item" href="../articles/xenium_landing.html">Xenium</a>
    <a class="dropdown-item" href="../articles/merfish_landing.html">MERFISH</a>
    <a class="dropdown-item" href="../articles/seqfish_landing.html">seqFISH</a>
    <a class="dropdown-item" href="../articles/codex_landing.html">CODEX/PhenoCycler</a>
    <a class="dropdown-item" href="../articles/splitseq_landing.html">SPLiT-seq</a>
    <a class="dropdown-item" href="../articles/chromium_landing.html">10X Chromium V3</a>
    <a class="dropdown-item" href="../articles/10xnuclei_landing.html">10X Chromium Nuclei Isolation</a>
    <a class="dropdown-item" href="../articles/10xcrispr_landing.html">10X Chromium Single Cell CRISPR</a>
    <a class="dropdown-item" href="../articles/10xatac_landing.html">10X Single Cell ATAC</a>
    <a class="dropdown-item" href="../articles/10xmultiome_landing.html">10X Single Cell Multiome</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-methods">Methods</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-methods">
    <h6 class="dropdown-header" data-toc-skip>Univariate global</h6>
    <a class="dropdown-item" href="../articles/moran_landing.html">Moran's I</a>
    <a class="dropdown-item" href="../articles/geary_landing.html">Geary's C</a>
    <a class="dropdown-item" href="../articles/correlogram_landing.html">Correlogram</a>
    <a class="dropdown-item" href="../articles/variogram_landing.html">Variogram</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Univariate local</h6>
    <a class="dropdown-item" href="../articles/moranplot_landing.html">Moran scatter plot</a>
    <a class="dropdown-item" href="../articles/localmoran_landing.html">Local Moran's I</a>
    <a class="dropdown-item" href="../articles/losh_landing.html">Local spatial heteroscedasticity</a>
    <a class="dropdown-item" href="../articles/getisord_landing.html">Getis-Ord Gi*</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Bivariate</h6>
    <a class="dropdown-item" href="../articles/lee_landing.html">Lee's L</a>
    <a class="dropdown-item" href="../articles/crossvariogram_landing.html">Cross variogram</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Multivariate</h6>
    <a class="dropdown-item" href="../articles/multispati_landing.html">MULTISPATI PCA</a>
    <a class="dropdown-item" href="../articles/localc_landing.html">Multivariate local Geary's C</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/sfemethod">Custom methods</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pachterlab/voyager/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>CODEX exploratory data analysis</h1>
                        <h4 data-toc-skip class="author">Kayla
Jackson</h4>
            
            <h4 data-toc-skip class="date">2023-06-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pachterlab/voyager/blob/HEAD/vignettes/vig8_codex.Rmd" class="external-link"><code>vignettes/vig8_codex.Rmd</code></a></small>
      <div class="d-none name"><code>vig8_codex.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pachterlab/voyager" class="external-link">Voyager</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning this package</span></span>
<span><span class="co">#&gt; will retire shortly. Please refer to R-spatial evolution reports on</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html for details.</span></span>
<span><span class="co">#&gt; This package is now running under evolution status 0</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: SummarizedExperiment</span></span>
<span><span class="co">#&gt; Loading required package: MatrixGenerics</span></span>
<span><span class="co">#&gt; Loading required package: matrixStats</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'MatrixGenerics'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:matrixStats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,</span></span>
<span><span class="co">#&gt;     colCounts, colCummaxs, colCummins, colCumprods, colCumsums,</span></span>
<span><span class="co">#&gt;     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,</span></span>
<span><span class="co">#&gt;     colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,</span></span>
<span><span class="co">#&gt;     colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,</span></span>
<span><span class="co">#&gt;     colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,</span></span>
<span><span class="co">#&gt;     colWeightedMeans, colWeightedMedians, colWeightedSds,</span></span>
<span><span class="co">#&gt;     colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,</span></span>
<span><span class="co">#&gt;     rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,</span></span>
<span><span class="co">#&gt;     rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,</span></span>
<span><span class="co">#&gt;     rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,</span></span>
<span><span class="co">#&gt;     rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,</span></span>
<span><span class="co">#&gt;     rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,</span></span>
<span><span class="co">#&gt;     rowWeightedMads, rowWeightedMeans, rowWeightedMedians,</span></span>
<span><span class="co">#&gt;     rowWeightedSds, rowWeightedVars</span></span>
<span><span class="co">#&gt; Loading required package: GenomicRanges</span></span>
<span><span class="co">#&gt; Loading required package: stats4</span></span>
<span><span class="co">#&gt; Loading required package: BiocGenerics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'BiocGenerics'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     IQR, mad, sd, var, xtabs</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     anyDuplicated, aperm, append, as.data.frame, basename, cbind,</span></span>
<span><span class="co">#&gt;     colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,</span></span>
<span><span class="co">#&gt;     get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,</span></span>
<span><span class="co">#&gt;     match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,</span></span>
<span><span class="co">#&gt;     Position, rank, rbind, Reduce, rownames, sapply, setdiff, sort,</span></span>
<span><span class="co">#&gt;     table, tapply, union, unique, unsplit, which.max, which.min</span></span>
<span><span class="co">#&gt; Loading required package: S4Vectors</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'S4Vectors'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     findMatches</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expand.grid, I, unname</span></span>
<span><span class="co">#&gt; Loading required package: IRanges</span></span>
<span><span class="co">#&gt; Loading required package: GenomeInfoDb</span></span>
<span><span class="co">#&gt; Loading required package: Biobase</span></span>
<span><span class="co">#&gt; Welcome to Bioconductor</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Vignettes contain introductory material; view with</span></span>
<span><span class="co">#&gt;     'browseVignettes()'. To cite Bioconductor, see</span></span>
<span><span class="co">#&gt;     'citation("Biobase")', and for packages 'citation("pkgname")'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Biobase'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:MatrixGenerics':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     rowMedians</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:matrixStats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     anyMissing, rowMedians</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/drighelli/SpatialExperiment" class="external-link">SpatialExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pachterlab/SpatialFeatureExperiment" class="external-link">SpatialFeatureExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">batchelor</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: scuttle</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ggplot2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:SpatialFeatureExperiment':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     unit</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bluster</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'glue'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:SummarizedExperiment':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     trim</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:GenomicRanges':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     trim</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:IRanges':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     trim</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'purrr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:SpatialFeatureExperiment':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     transpose</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:GenomicRanges':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     reduce</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:IRanges':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     reduce</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'tidyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:S4Vectors':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expand</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:Biobase':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     combine</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:GenomicRanges':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, union</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:GenomeInfoDb':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:IRanges':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     collapse, desc, intersect, setdiff, slice, union</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:S4Vectors':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     first, intersect, rename, setdiff, setequal, union</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:BiocGenerics':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     combine, intersect, setdiff, union</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:matrixStats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     count</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yutannihilation.github.io/gghighlight/" class="external-link">gghighlight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: spData</span></span>
<span><span class="co">#&gt; To access larger datasets in this package, install the spDataLarge</span></span>
<span><span class="co">#&gt; package with: `install.packages('spDataLarge',</span></span>
<span><span class="co">#&gt; repos='https://nowosad.github.io/drat/', type='source')`</span></span>
<span><span class="co">#&gt; Loading required package: sf</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sales-lab/spatialDE" class="external-link">spatialDE</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Bioconductor/BiocParallel" class="external-link">BiocParallel</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>The dataset used in this vignette is from the paper <a href="doi.org/10.3389/fimmu.2021.727626">Strategies for Accurate Cell
Type Identification in CODEX Multiplexed Imaging Data</a>(Hickey, et.al
2021). The data were collected as part of the HuBMap consortium which
seeks to characterize healthy human tissues and make data broadly
available. More specifically, this dataset characterizes 4 regions of
the large intestine (colon) from a single donor. This vignette will
focus on data from the sigmoid colon.</p>
<p>The intestinal sections were interrogated using the multiplexed
imaging method CO-Detection by indEXing (CODEX). CODEX involves cyclical
staining of a tissue with DNA-barcoded antibodies. At each round of
experimentation, fluoresently labeled probes hybridize to the tissue
bound DNA-conjugated antibodies are subsequently imaged and the stripped
from the tissue. At present, the technology quantifies up to 60 markers
in a single experiment. Raw images generated from this process are
subjected to image stitching, drift compensation, deconvolution, and
cycle concatenation using publicly avaialable <a href="https://github.com/nolanlab/CODEX" class="external-link">software</a>. The result of
this pre-processing is a matrix that contains the location of individual
cells and the quantified markers for each cell. Cell types were assigned
as described in the manuscript linked above. Briefly, the authors used a
hand-gating strategy to define cell types and create a standard to
compare the effect of normalization methods on clustering and cell
annotation.</p>
<p>The raw intensity data are available for download from HuBMAP with
identifier <a href="https://portal.hubmapconsortium.org/browse/dataset/e6fd525b837f4cf736c8af830f4f750f" class="external-link">HBM575.THQMM.284</a>
and the cell type annotations are provided as supplementary data in the
manuscript. The data relevant to this vignette have been converted to a
<code>SFE</code> object and are available to download <a href="https://caltech.box.com/public/static/zfr8l20450n2z28lnp0ugdj471ph9eyx" class="external-link">here</a>
from Box.</p>
<p>These data will be submitted to the <code>SFEData</code> package on
Bioconductor and will be available there in a future release.</p>
<p>We will begin by downloading the data and loading it in to R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://caltech.box.com/public/static/zfr8l20450n2z28lnp0ugdj471ph9eyx"</span>,<span class="st">'./codex.Rds'</span>, mode<span class="op">=</span><span class="st">'wb'</span>, method <span class="op">=</span> <span class="st">'wget'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sfe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./codex.Rds"</span><span class="op">)</span></span>
<span><span class="va">sfe</span></span>
<span><span class="co">#&gt; class: SpatialFeatureExperiment </span></span>
<span><span class="co">#&gt; dim: 47 19724 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(1): protein</span></span>
<span><span class="co">#&gt; rownames(47): MUC2 SOX9 ... CD49a CD163</span></span>
<span><span class="co">#&gt; rowData names(0):</span></span>
<span><span class="co">#&gt; colnames(19724): 1 2 ... 182 184</span></span>
<span><span class="co">#&gt; colData names(9): cell_id cell_type ... fn sample_id</span></span>
<span><span class="co">#&gt; reducedDimNames(0):</span></span>
<span><span class="co">#&gt; mainExpName: NULL</span></span>
<span><span class="co">#&gt; altExpNames(0):</span></span>
<span><span class="co">#&gt; spatialCoords names(2) : X Y</span></span>
<span><span class="co">#&gt; imgData names(0):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; unit: full_res_image_pixels</span></span>
<span><span class="co">#&gt; Geometries:</span></span>
<span><span class="co">#&gt; colGeometries: centroids (POINT) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Graphs:</span></span>
<span><span class="co">#&gt; sample01:</span></span></code></pre></div>
<p>The rows in the count matrix correspond to the 47 barcoded genes
measured by CODEX. Additionally, the authors provide some metadata for
the cells, including the cell type.</p>
<p>It turns out the column names are not unique which will cause errors
in downstream analysis. We will update the column names below</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cellids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{colData(sfe)$fn}_{colData(sfe)$cell_id}"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cellids</span></span></code></pre></div>
<div class="section level3">
<h3 id="exploratory-data-analysis">Exploratory Data Analysis<a class="anchor" aria-label="anchor" href="#exploratory-data-analysis"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">celldensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotCellBin2D.html">plotCellBin2D</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">celldensity</span></span></code></pre></div>
<p><img src="vig8_codex_files/figure-html/unnamed-chunk-5-1.png" width="700" style="display: block; margin: auto;">
We can see from the figure above that the colonic epithelium is enriched
with cells while the loose connective tissue and muscle layers beneath
the epithelial layer are more sparsely populated. This is in line with
known colon histology. The epithelium is enriched with goblet cells and
has invaginations that project inwards towards the connective tissue.
Smooth muscle cells are also prominent in the colon, where bands of
muscle contract to move colonic contents towards the rectum.</p>
<p>We can visualize these cell types in space using the
<code><a href="../reference/plotSpatialFeature.html">plotSpatialFeature()</a></code> function. We will highlight Goblet and
smooth muscle cells to display their relative distribution in the
tissue. Since CODEX image processing relies on segmentation, each dot in
the plot represents a single cell. Here, each cell is represented by its
centroid, but can also be visualized as cell polygons in cases where the
segmentation mask is available.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotSpatialFeature.html">plotSpatialFeature</a></span><span class="op">(</span><span class="va">sfe</span>, features<span class="op">=</span><span class="st">'cell_type'</span>, colGeometryName <span class="op">=</span> <span class="st">"centroids"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html" class="external-link">gghighlight</a></span><span class="op">(</span><span class="va">cell_type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Goblet"</span>, <span class="st">"SmoothMuscleME"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Tried to calculate with group_by(), but the calculation failed.</span></span>
<span><span class="co">#&gt; Falling back to ungrouped filter operation...</span></span>
<span></span>
<span><span class="va">spatial</span></span></code></pre></div>
<p><img src="vig8_codex_files/figure-html/unnamed-chunk-6-1.png" width="700" style="display: block; margin: auto;">
The goblet cells clearly define the epithelial border of the tissue and
the thick bands of smooth muscle cells are prominent below the
mucosa.</p>
<p>Next, we will compute some gene level metrics for each of the 47
barcoded genes. In contrast to RNA-based methods, the fields in the
matrix represent intensities rather than counts.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MatrixGenerics/man/rowMeans.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu">rowVars</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">var</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig8_codex_files/figure-html/unnamed-chunk-7-1.png" width="700" style="display: block; margin: auto;">
There appears to be a sigmoid relationship between the mean and variance
of the protein expression. The pattern is reminiscent of what might be
expected if the intensity values were derived from a Gamma distribution,
the continuous analog of the Negative Binomial distribution that is
typically used to describe count data from scRNA-seq experiments. This
may have implications for how CODEX data is variance stabilized in the
future.</p>
<p>CODEX data is subject to noise from several sources including
segmentation artifacts, nonspecific staining, and imperfect tissue
processing. These are factors that can limit accurate quantification of
signal intensity and impede accurate cell annotation. The authors of the
dataset tested the effects of several normalization methods on cell type
annotation and clustering and found that Z-score normalization of each
marker resulted in accurate identification of both rare and common cell
types. In the cell below, we demonstrate how to accomplish this using
standard matrix operations. The normalized count matrix is typically
stored in the <code>logcounts</code> slot for scRNA-seq data, but we
will instead store the normalized matrix in a slot called
<code>normalizedIntensity</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">sfe</span>, <span class="st">'protein'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">sfe</span>, <span class="st">'normalizedIntensity'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mtx</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/MatrixGenerics/man/rowMeans.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mtx</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu">rowSds</span><span class="op">(</span><span class="va">mtx</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of length 2</span></span>
<span><span class="co">#&gt; names(2): protein normalizedIntensity</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="spatial-eda">Spatial EDA<a class="anchor" aria-label="anchor" href="#spatial-eda"></a>
</h2>
<p>Neighbor definition is a critical step in computation of metrics of
spatial dependency like Moran’s I and Geary’s C. The definition of
neighbors is complex, even when cell polygons are available. In the
latter case, the <code>poly2nb</code> method might be appropriate to
assign two cells as neighbors if they physically touch each other or
share a border. This may not be tenable in cases where cells are sparse
or cells are represented by their centroids, as in this dataset.</p>
<p>We will compute the spatial neighborhood graph using the
<code>knearestneigh</code> function as it is implemented in
<code>spdep</code>. In brief, Euclidean distances are computed between
each pair of cells and the <code>k</code> nearest cells are considered
neighbors. In the following code cell, we will consdier
<code>k=10</code> for speed purposes, but this may not be ideal in
general.</p>
<p>The weights of the neighborhood matrix are inverse-distance weighted,
such that the the weight of regions listed as neighbors increases as the
distance between pairs of points decreases. Setting
<code>style = "W"</code> ensures that the weights are row
standardized.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SpatialFeatureExperiment/man/spatialGraphs.html" class="external-link">colGraph</a></span><span class="op">(</span><span class="va">sfe</span>, <span class="st">"knn10"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialFeatureExperiment/man/findSpatialNeighbors-SpatialFeatureExperiment-method.html" class="external-link">findSpatialNeighbors</a></span><span class="op">(</span></span>
<span>    <span class="va">sfe</span>, method <span class="op">=</span> <span class="st">"knearneigh"</span>, dist_type <span class="op">=</span> <span class="st">"idw"</span>, </span>
<span>    k <span class="op">=</span> <span class="fl">10</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in (function (to_check, X, clust_centers, clust_info, dtype, nn, :</span></span>
<span><span class="co">#&gt; detected tied distances to neighbors, see ?'BiocNeighbors-ties'</span></span></code></pre></div>
<p>The <code><a href="../reference/plotColGraph.html">plotColGraph()</a></code> function plots the graph in space
along with its corresponding <code>colGeometry</code>, but since there
are so many cells in this dataset, plotting the neighborhood graph may
not be as useful as many connections will be obscure by overlapping
lines. In any case, we will demonstrate use of the function below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotColGraph.html">plotColGraph</a></span><span class="op">(</span><span class="va">sfe</span>, colGraphName <span class="op">=</span> <span class="st">"knn10"</span>, colGeometryName <span class="op">=</span> <span class="st">'centroids'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig8_codex_files/figure-html/unnamed-chunk-10-1.png" width="700" style="display: block; margin: auto;">
Next, we will explore univariate metrics for global spatial
autocorrelation. Since few genes are quantified in this study, we will
compute the metrics for all genes. For larger datasets, it may be useful
to restrict analysis to the most variable genes.</p>
<p>We use the <code><a href="../reference/calculateUnivariate.html">runUnivariate()</a></code> function to compute the
spatial autocorrelation metrics and save the results in the SFE
object.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sfe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateUnivariate.html">runUnivariate</a></span><span class="op">(</span></span>
<span>    <span class="va">sfe</span>, type <span class="op">=</span> <span class="st">"moran.mc"</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span>,</span>
<span>    exprs_values <span class="op">=</span> <span class="st">"normalizedIntensity"</span>, colGraphName <span class="op">=</span> <span class="st">"knn10"</span>, nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sfe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateUnivariate.html">runUnivariate</a></span><span class="op">(</span></span>
<span>    <span class="va">sfe</span>, type <span class="op">=</span> <span class="st">"moran.plot"</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span>,</span>
<span>    exprs_values <span class="op">=</span> <span class="st">"normalizedIntensity"</span>, colGraphName <span class="op">=</span> <span class="st">"knn10"</span><span class="op">)</span></span></code></pre></div>
<p>The results of these computations are accessible in the
<code>rowData</code> attribute of the SFE object.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mean"                          "var"                          </span></span>
<span><span class="co">#&gt; [3] "moran.mc_statistic_sample01"   "moran.mc_parameter_sample01"  </span></span>
<span><span class="co">#&gt; [5] "moran.mc_p.value_sample01"     "moran.mc_alternative_sample01"</span></span>
<span><span class="co">#&gt; [7] "moran.mc_method_sample01"      "moran.mc_res_sample01"</span></span></code></pre></div>
<p>Next, we plot the results of the genes with the highest Moran’s I
statistic.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">top_moran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">moran.mc_statistic_sample01</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">moran</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotMoranMC.html">plotMoranMC</a></span><span class="op">(</span><span class="va">sfe</span>, features <span class="op">=</span> <span class="va">top_moran</span>, facet_by <span class="op">=</span> <span class="st">'features'</span><span class="op">)</span></span>
<span><span class="va">moran</span></span></code></pre></div>
<p><img src="vig8_codex_files/figure-html/unnamed-chunk-13-1.png" width="700" style="display: block; margin: auto;">
The vertical line in each plot represents the observed Moran’s I while
the density represents the Moran’s I statistic for each of the random
permutations of the data. Each of these plots suggests that the Moran’s
I statistic is significant. We can plot the normalized intensity for
these genes in space.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSpatialFeature.html">plotSpatialFeature</a></span><span class="op">(</span></span>
<span>    <span class="va">sfe</span>, features<span class="op">=</span><span class="va">top_moran</span>, colGeometryName <span class="op">=</span> <span class="st">"centroids"</span>,</span>
<span>    exprs_values <span class="op">=</span> <span class="st">"normalizedIntensity"</span>, scattermore <span class="op">=</span> <span class="cn">TRUE</span>, pointsize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig8_codex_files/figure-html/unnamed-chunk-14-1.png" width="1152" style="display: block; margin: auto;">
While most of these genes appear to have some spatial distribution, it
also seems that it may overlap with cell type. The cells that appear to
express the genes of interest seem to be spatially restricted to known
boundaries in the tissue.</p>
<p>The <code><a href="../reference/moranPlot.html">moranPlot()</a></code> function plots spatial data against its
spatially lagged values and enables users to assess how similar observed
values are to its neighbors. When the variable is centered, the plot is
divided into four quadrants defined by the horizontal line y = 0 and the
vertical line x = 0. Points in the upper right (or high-high) and lower
left (or low-low) quadrants indicate positive spatial association, and
points in the lower right (or high-low) and upper left (or low-high)
quadrants include observations that exhibit negative spatial
association.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/moranPlot.html">moranPlot</a></span><span class="op">(</span><span class="va">sfe</span>, <span class="va">top_moran</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig8_codex_files/figure-html/unnamed-chunk-15-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="differential-expression">Differential Expression<a class="anchor" aria-label="anchor" href="#differential-expression"></a>
</h2>
<p>While Moran’s I and other global spatial autocorrelation metrics
provide insight to the spatial patterns of gene expression, it is
necessarily limited by the structure imposed by the spatial weights
matrix. A complimentary task might be to identify spatially variable
(SV) genes. One such method to do this is described in <a href="">SpatialDE: identification of spatially variable genes</a>. The
method described in the manuscript relies on Gaussian process regression
and decomposes variability in expression into spatial and non-spatial
components. In contrast to Moran’s I, the covariance between each pair
of cells is modeled as a function of the distance between them. Notably,
it does not require an explicit specification of hte neighborhood graph,
but rather the a parameter controls the decay in covariance as distance
increases.</p>
<p>The <code>spatialDE</code> package is implemented in R and requires a
normalized matrix as input. The <code><a href="https://rdrr.io/pkg/spatialDE/man/spatialDE.html" class="external-link">spatialDE()</a></code> function from
the package performs normalization steps before running the algorithm.
Because the data has already been normalized, we will use the
<code><a href="https://rdrr.io/pkg/spatialDE/man/run.html" class="external-link">run()</a></code> function directly to run spatialDE. We will first
have to convert the centroid coordinates to a data frame as required by
the function.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store coordinates in a data frame object</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpatialFeatureExperiment/man/dimGeometries.html" class="external-link">centroids</a></span><span class="op">(</span><span class="va">sfe</span><span class="op">)</span><span class="op">$</span><span class="va">geometry</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># de_res &lt;- spatialDE::run(assay(sfe,"normalizedIntensity"), coords, verbose=TRUE)</span></span></code></pre></div>
<p>We can plot the normalized expression of the top 5 genes in
space.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># top_genes &lt;- de_res |&gt;</span></span>
<span><span class="co">#   arrange(pval) |&gt;</span></span>
<span><span class="co">#   slice_head(n=6) |&gt;</span></span>
<span><span class="co">#   pull(g)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># plotSpatialFeature(sfe, top_genes, colGeometryName="centroids",</span></span>
<span><span class="co">#                    exprs_values = "normalizedIntensity")</span></span></code></pre></div>
<p>Perhaps unsurprisingly, the expression of the top DE genes seems to
highlight the spatial distribution of known cell types in the tissue
rather than identify spatially restricted gene expression. This is
related to the experimental design where the targeted genes were chosen
to differentiate cell types. Perhaps in genome-wide technologies, the
potential for discovery of neew gene expression patterns is more
plausible. There is an open question as to whether these results offer
new information compared to what is inferred by typical DE expression
methods.</p>
<p>These analyses represent a minority of the types of inferences that
can be made from protein expression data. It would be interested to
investigate how the protein expression results compare or inform data
from spatail scRNA-sequencing experiments. Already, there is work being
done to obtain multimodal spatial measurements on the same sample.
Importantly however, considerations should be made on the types of
biases each individual technology adds to the measurements. These are
active areas of research that are ripe for future exploration.</p>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">#&gt; Platform: x86_64-apple-darwin20 (64-bit)</span></span>
<span><span class="co">#&gt; Running under: macOS Monterey 12.6.6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] BiocParallel_1.34.2            spatialDE_1.6.0               </span></span>
<span><span class="co">#&gt;  [3] spdep_1.2-8                    sf_1.0-13                     </span></span>
<span><span class="co">#&gt;  [5] spData_2.2.2                   patchwork_1.1.2               </span></span>
<span><span class="co">#&gt;  [7] gghighlight_0.4.0              dplyr_1.1.2                   </span></span>
<span><span class="co">#&gt;  [9] tidyr_1.3.0                    purrr_1.0.1                   </span></span>
<span><span class="co">#&gt; [11] glue_1.6.2                     bluster_1.10.0                </span></span>
<span><span class="co">#&gt; [13] scran_1.28.1                   scater_1.28.0                 </span></span>
<span><span class="co">#&gt; [15] ggplot2_3.4.2                  scuttle_1.10.1                </span></span>
<span><span class="co">#&gt; [17] batchelor_1.16.0               SpatialFeatureExperiment_1.2.1</span></span>
<span><span class="co">#&gt; [19] SpatialExperiment_1.10.0       SingleCellExperiment_1.22.0   </span></span>
<span><span class="co">#&gt; [21] SummarizedExperiment_1.30.2    Biobase_2.60.0                </span></span>
<span><span class="co">#&gt; [23] GenomicRanges_1.52.0           GenomeInfoDb_1.36.0           </span></span>
<span><span class="co">#&gt; [25] IRanges_2.34.0                 S4Vectors_0.38.1              </span></span>
<span><span class="co">#&gt; [27] BiocGenerics_0.46.0            MatrixGenerics_1.12.2         </span></span>
<span><span class="co">#&gt; [29] matrixStats_1.0.0              Voyager_1.2.3                 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] RColorBrewer_1.1-3        jsonlite_1.8.5           </span></span>
<span><span class="co">#&gt;   [3] wk_0.7.3                  magrittr_2.0.3           </span></span>
<span><span class="co">#&gt;   [5] ggbeeswarm_0.7.2          magick_2.7.4             </span></span>
<span><span class="co">#&gt;   [7] farver_2.1.1              rmarkdown_2.22           </span></span>
<span><span class="co">#&gt;   [9] fs_1.6.2                  zlibbioc_1.46.0          </span></span>
<span><span class="co">#&gt;  [11] ragg_1.2.5                vctrs_0.6.3              </span></span>
<span><span class="co">#&gt;  [13] memoise_2.0.1             DelayedMatrixStats_1.22.1</span></span>
<span><span class="co">#&gt;  [15] RCurl_1.98-1.12           terra_1.7-37             </span></span>
<span><span class="co">#&gt;  [17] htmltools_0.5.5           S4Arrays_1.0.4           </span></span>
<span><span class="co">#&gt;  [19] BiocNeighbors_1.18.0      Rhdf5lib_1.22.0          </span></span>
<span><span class="co">#&gt;  [21] s2_1.1.4                  rhdf5_2.44.0             </span></span>
<span><span class="co">#&gt;  [23] sass_0.4.6                KernSmooth_2.23-21       </span></span>
<span><span class="co">#&gt;  [25] bslib_0.5.0               basilisk_1.12.0          </span></span>
<span><span class="co">#&gt;  [27] desc_1.4.2                cachem_1.0.8             </span></span>
<span><span class="co">#&gt;  [29] ResidualMatrix_1.10.0     igraph_1.5.0             </span></span>
<span><span class="co">#&gt;  [31] lifecycle_1.0.3           pkgconfig_2.0.3          </span></span>
<span><span class="co">#&gt;  [33] rsvd_1.0.5                Matrix_1.5-4.1           </span></span>
<span><span class="co">#&gt;  [35] R6_2.5.1                  fastmap_1.1.1            </span></span>
<span><span class="co">#&gt;  [37] GenomeInfoDbData_1.2.10   digest_0.6.31            </span></span>
<span><span class="co">#&gt;  [39] colorspace_2.1-0          ggnewscale_0.4.9         </span></span>
<span><span class="co">#&gt;  [41] rprojroot_2.0.3           dqrng_0.3.0              </span></span>
<span><span class="co">#&gt;  [43] RSpectra_0.16-1           irlba_2.3.5.1            </span></span>
<span><span class="co">#&gt;  [45] textshaping_0.3.6         beachmat_2.16.0          </span></span>
<span><span class="co">#&gt;  [47] labeling_0.4.2            filelock_1.0.2           </span></span>
<span><span class="co">#&gt;  [49] fansi_1.0.4               mgcv_1.8-42              </span></span>
<span><span class="co">#&gt;  [51] compiler_4.3.1            proxy_0.4-27             </span></span>
<span><span class="co">#&gt;  [53] withr_2.5.0               backports_1.4.1          </span></span>
<span><span class="co">#&gt;  [55] viridis_0.6.3             DBI_1.1.3                </span></span>
<span><span class="co">#&gt;  [57] highr_0.10                HDF5Array_1.28.1         </span></span>
<span><span class="co">#&gt;  [59] R.utils_2.12.2            MASS_7.3-60              </span></span>
<span><span class="co">#&gt;  [61] DelayedArray_0.26.3       rjson_0.2.21             </span></span>
<span><span class="co">#&gt;  [63] classInt_0.4-9            tools_4.3.1              </span></span>
<span><span class="co">#&gt;  [65] units_0.8-2               vipor_0.4.5              </span></span>
<span><span class="co">#&gt;  [67] beeswarm_0.4.0            R.oo_1.25.0              </span></span>
<span><span class="co">#&gt;  [69] nlme_3.1-162              rhdf5filters_1.12.1      </span></span>
<span><span class="co">#&gt;  [71] grid_4.3.1                checkmate_2.2.0          </span></span>
<span><span class="co">#&gt;  [73] cluster_2.1.4             generics_0.1.3           </span></span>
<span><span class="co">#&gt;  [75] isoband_0.2.7             gtable_0.3.3             </span></span>
<span><span class="co">#&gt;  [77] R.methodsS3_1.8.2         class_7.3-22             </span></span>
<span><span class="co">#&gt;  [79] metapod_1.8.0             BiocSingular_1.16.0      </span></span>
<span><span class="co">#&gt;  [81] ScaledMatrix_1.8.1        sp_1.6-1                 </span></span>
<span><span class="co">#&gt;  [83] utf8_1.2.3                XVector_0.40.0           </span></span>
<span><span class="co">#&gt;  [85] ggrepel_0.9.3             pillar_1.9.0             </span></span>
<span><span class="co">#&gt;  [87] stringr_1.5.0             limma_3.56.2             </span></span>
<span><span class="co">#&gt;  [89] splines_4.3.1             lattice_0.21-8           </span></span>
<span><span class="co">#&gt;  [91] deldir_1.0-9              tidyselect_1.2.0         </span></span>
<span><span class="co">#&gt;  [93] locfit_1.5-9.8            knitr_1.43               </span></span>
<span><span class="co">#&gt;  [95] gridExtra_2.3             edgeR_3.42.4             </span></span>
<span><span class="co">#&gt;  [97] scattermore_1.2           xfun_0.39                </span></span>
<span><span class="co">#&gt;  [99] statmod_1.5.0             DropletUtils_1.20.0      </span></span>
<span><span class="co">#&gt; [101] stringi_1.7.12            yaml_2.3.7               </span></span>
<span><span class="co">#&gt; [103] boot_1.3-28.1             evaluate_0.21            </span></span>
<span><span class="co">#&gt; [105] codetools_0.2-19          tibble_3.2.1             </span></span>
<span><span class="co">#&gt; [107] cli_3.6.1                 reticulate_1.30          </span></span>
<span><span class="co">#&gt; [109] systemfonts_1.0.4         munsell_0.5.0            </span></span>
<span><span class="co">#&gt; [111] jquerylib_0.1.4           Rcpp_1.0.10              </span></span>
<span><span class="co">#&gt; [113] dir.expiry_1.8.0          png_0.1-8                </span></span>
<span><span class="co">#&gt; [115] parallel_4.3.1            pkgdown_2.0.7            </span></span>
<span><span class="co">#&gt; [117] basilisk.utils_1.12.1     sparseMatrixStats_1.12.1 </span></span>
<span><span class="co">#&gt; [119] bitops_1.0-7              viridisLite_0.4.2        </span></span>
<span><span class="co">#&gt; [121] scales_1.2.1              e1071_1.7-13             </span></span>
<span><span class="co">#&gt; [123] crayon_1.5.2              scico_1.4.0              </span></span>
<span><span class="co">#&gt; [125] rlang_1.1.1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lambda Moses, Kayla Jackson, Laura Luebbert, Lior Pachter.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
